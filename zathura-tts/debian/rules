#!/usr/bin/make -f

# Enable all hardening options
export DEB_BUILD_MAINT_OPTIONS = hardening=+all

# Enable verbose build output
export DH_VERBOSE = 1

# Meson build options
MESON_OPTIONS = \
	-Dtests=true \
	-Ddocs=true \
	-Dpiper_support=true \
	-Dspeechd_support=true \
	-Despeak_support=true

%:
	dh $@ --buildsystem=meson

override_dh_auto_configure:
	dh_auto_configure -- $(MESON_OPTIONS)

override_dh_auto_test:
	# Run tests during build
	dh_auto_test

override_dh_auto_install:
	dh_auto_install
	# Remove any .la files if present
	find debian/tmp -name '*.la' -delete

override_dh_missing:
	dh_missing --fail-missing

# Install additional files
override_dh_install:
	dh_install
	# Install voice samples if present
	if [ -d voices/ ]; then \
		install -d debian/zathura-tts/usr/share/zathura-tts/voices/; \
		cp -r voices/* debian/zathura-tts/usr/share/zathura-tts/voices/; \
	fi
	# Install documentation
	if [ -d docs/ ]; then \
		install -d debian/zathura-tts/usr/share/doc/zathura-tts/; \
		cp docs/*.md debian/zathura-tts/usr/share/doc/zathura-tts/; \
	fi

# Generate debug package
override_dh_strip:
	dh_strip --dbgsym-migration='zathura-tts-dbg (<< 1.0.0-1~)'